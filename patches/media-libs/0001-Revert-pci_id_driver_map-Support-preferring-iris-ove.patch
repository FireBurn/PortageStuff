From bdcb90ff5b5fbf23d96f467ecbc4d01ee70f4b2a Mon Sep 17 00:00:00 2001
From: Mike Lothian <mike@fireburn.co.uk>
Date: Sat, 31 Aug 2019 18:52:16 +0100
Subject: [PATCH] Revert "pci_id_driver_map: Support preferring iris over i965"

This reverts commit cfbde3282d9b881a8cb09dc7a9c2b25b69872e32.
---
 include/pci_ids/i965_pci_ids.h | 18 +-----------------
 src/loader/pci_id_driver_map.h | 17 +++--------------
 2 files changed, 4 insertions(+), 31 deletions(-)

diff --git a/include/pci_ids/i965_pci_ids.h b/include/pci_ids/i965_pci_ids.h
index 7d1d051e4e1..646df447bd7 100644
--- a/include/pci_ids/i965_pci_ids.h
+++ b/include/pci_ids/i965_pci_ids.h
@@ -1,11 +1,4 @@
-/*
- * IRIS not defined: include all devices supported by i965 or iris
- * IRIS == 0: devices where i965 is supported
- * IRIS == 1: devices where iris is supported, and will be tried before i965
- * IRIS == 2: devices where iris is supported, and will be tried after i965
- */
-#if !defined(IRIS) || IRIS == 0
-/* Only try to load i965. Do not attempt iris. */
+#ifndef IRIS
 CHIPSET(0x29A2, i965,    "Intel(R) 965G")
 CHIPSET(0x2992, i965,    "Intel(R) 965Q")
 CHIPSET(0x2982, i965,    "Intel(R) 965G")
@@ -104,8 +97,6 @@ CHIPSET(0x22B1, chv,     "Intel(R) HD Graphics XXX (Braswell)") /* Overridden in
 CHIPSET(0x22B2, chv,     "Intel(R) HD Graphics (Cherryview)")
 CHIPSET(0x22B3, chv,     "Intel(R) HD Graphics (Cherryview)")
 #endif
-#if !defined(IRIS) || IRIS == 0 || IRIS == 2
-/* First try to load i965, then try iris */
 CHIPSET(0x1602, bdw_gt1, "Intel(R) Broadwell GT1")
 CHIPSET(0x1606, bdw_gt1, "Intel(R) Broadwell GT1")
 CHIPSET(0x160A, bdw_gt1, "Intel(R) Broadwell GT1")
@@ -248,10 +239,3 @@ CHIPSET(0x4500, ehl_4x8, "Intel(R) HD Graphics (Elkhart Lake 4x8)")
 CHIPSET(0x4571, ehl_4x8, "Intel(R) HD Graphics (Elkhart Lake 4x8)")
 CHIPSET(0x4551, ehl_4x4, "Intel(R) HD Graphics (Elkhart Lake 4x4)")
 CHIPSET(0x4541, ehl_2x4, "Intel(R) HD Graphics (Elkhart Lake 2x4)")
-#endif
-#if !defined(IRIS) || IRIS == 0 || IRIS == 1
-/* First try to load iris, then try i965 */
-#endif
-#if !defined(IRIS) || IRIS == 1
-/* Only try to load iris. Do not attempt i965. */
-#endif
diff --git a/src/loader/pci_id_driver_map.h b/src/loader/pci_id_driver_map.h
index 2909f69f24f..99fe4ad2161 100644
--- a/src/loader/pci_id_driver_map.h
+++ b/src/loader/pci_id_driver_map.h
@@ -19,23 +19,13 @@ static const int i915_chip_ids[] = {
 
 static const int i965_chip_ids[] = {
 #define CHIPSET(chip, family, name) chip,
-#define IRIS 0 /* all i965 devices */
 #include "pci_ids/i965_pci_ids.h"
-#undef IRIS
-#undef CHIPSET
-};
-
-static const int iris_chip_ids_1[] = {
-#define CHIPSET(chip, family, name) chip,
-#define IRIS 1 /* iris devices to try before i965 */
-#include "pci_ids/i965_pci_ids.h"
-#undef IRIS
 #undef CHIPSET
 };
 
-static const int iris_chip_ids_2[] = {
+static const int iris_chip_ids[] = {
 #define CHIPSET(chip, family, name) chip,
-#define IRIS 2 /* iris devices to try after i965 */
+#define IRIS 1
 #include "pci_ids/i965_pci_ids.h"
 #undef IRIS
 #undef CHIPSET
@@ -93,9 +83,8 @@ static const struct {
    int (*predicate)(int fd);
 } driver_map[] = {
    { 0x8086, "i915", i915_chip_ids, ARRAY_SIZE(i915_chip_ids) },
-   { 0x8086, "iris", iris_chip_ids_1, ARRAY_SIZE(iris_chip_ids_1) },
    { 0x8086, "i965", i965_chip_ids, ARRAY_SIZE(i965_chip_ids) },
-   { 0x8086, "iris", iris_chip_ids_2, ARRAY_SIZE(iris_chip_ids_2) },
+   { 0x8086, "iris", iris_chip_ids, ARRAY_SIZE(iris_chip_ids) },
    { 0x1002, "radeon", r100_chip_ids, ARRAY_SIZE(r100_chip_ids) },
    { 0x1002, "r200", r200_chip_ids, ARRAY_SIZE(r200_chip_ids) },
    { 0x1002, "r300", r300_chip_ids, ARRAY_SIZE(r300_chip_ids) },
-- 
2.23.0

