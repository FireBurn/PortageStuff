From 0e84525cafb5671dfc15e6a878df4887ce2b3c63 Mon Sep 17 00:00:00 2001
From: Emil Velikov <emil.velikov@collabora.com>
Date: Fri, 10 Mar 2017 12:27:56 +0000
Subject: [PATCH 41/44] winsys/amdgpu: use drmGetDevice2 API
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Analogous to previous commit

Signed-off-by: Emil Velikov <emil.velikov@collabora.com>
Reviewed-by: Michel Dänzer <michel.daenzer@amd.com>
Reviewed-by: Marek Olšák <marek.olsak@amd.com>
Reviewed-by: Eric Engestrom <eric.engestrom@imgtec.com>
---
 src/gallium/winsys/amdgpu/drm/amdgpu_winsys.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gallium/winsys/amdgpu/drm/amdgpu_winsys.c b/src/gallium/winsys/amdgpu/drm/amdgpu_winsys.c
index bf7a057399..37e0140311 100644
--- a/src/gallium/winsys/amdgpu/drm/amdgpu_winsys.c
+++ b/src/gallium/winsys/amdgpu/drm/amdgpu_winsys.c
@@ -108,9 +108,9 @@ static bool do_winsys_init(struct amdgpu_winsys *ws, int fd)
    drmDevicePtr devinfo;
 
    /* Get PCI info. */
-   r = drmGetDevice(fd, &devinfo);
+   r = drmGetDevice2(fd, 0, &devinfo);
    if (r) {
-      fprintf(stderr, "amdgpu: drmGetDevice failed.\n");
+      fprintf(stderr, "amdgpu: drmGetDevice2 failed.\n");
       goto fail;
    }
    ws->info.pci_domain = devinfo->businfo.pci->domain;
-- 
2.12.0

